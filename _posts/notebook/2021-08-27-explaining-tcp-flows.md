---
layout: post
title: Explaining TCP flows
categories: en tip
author: "Son Pham"
meta: Explaining TCP flows
description: "Explaining TCP flows"
comments: true
---

| Flow                       |                                                              | Explaination                                                 |
| -------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| client -[SYN]-> server     | **Transmission Control Protocol, Src Port: 24491, Dst Port: 5000, Seq: 0, Len: 0**<br/>    **Source Port: 24491**<br/>    Destination Port: 5000<br/>    [Stream index: 0]<br/>    [TCP Segment Len: 0]<br/>    **Sequence Number: 0**    (relative sequence number)<br/>    **Sequence Number (raw): 4126488336**<br/>    [Next Sequence Number: 1    (relative sequence number)]<br/>    **Acknowledgment Number: 0**<br/>    **Acknowledgment number (raw): 0**<br/>    1000 .... = Header Length: 32 bytes (8)<br/>    **Flags: 0x002 (SYN)**<br/>    **Window: 65535**<br/>    [Calculated window size: 65535]<br/>    Checksum: 0xd6b0 [unverified]<br/>    [Checksum Status: Unverified]<br/>    Urgent Pointer: 0<br /> | First, client says "hi there, I'd like to connect, here is my number **xxxxxxx36** "<br /><br />When client send a SYN packet to server. Wireshark will show you the relative sequence, or ACK number which is 0. But actually, it is a random number .<br /><br /> |
| client <-[SYN,ACK]- server | **Transmission Control Protocol, Src Port: 5000, Dst Port: 24491, Seq: 0, Ack: 1, Len: 0**<br/>    **Source Port: 5000**<br/>    Destination Port: 24491<br/>    [Stream index: 0]<br/>    [TCP Segment Len: 0]<br/>    **Sequence Number: 0**    (relative sequence number)<br/>    **Sequence Number (raw): 547479085**<br/>    [Next Sequence Number: 1    (relative sequence number)]<br/>    **Acknowledgment Number: 1**    (relative ack number)<br/>    **Acknowledgment number (raw): 4126488337**<br/>    1000 .... = Header Length: 32 bytes (8)<br/>    **Flags: 0x012 (SYN, ACK)**<br/>    **Window: 65535**<br/>    [Calculated window size: 65535]<br/>    Checksum: 0xd7d0 [unverified]<br/>    [Checksum Status: Unverified]<br/>    Urgent Pointer: 0<br/>    Options: (12 bytes), Maximum segment size, No-Operation (NOP), Window scale, No-Operation (NOP), No-Operation (NOP), SACK permitted<br/>    [SEQ/ACK analysis]<br/>    [Timestamps] | Server responses "oh sure, I've received your number **xxxxxxx36**. And I add one to keep track, so now it is  **xxxxxxx37**. Please take my number **xxxxxxx85** "<br />After received the packet from client, server will send its own Sequence number **547479085** and Ackowledgement number.<br />The Acknowledge number is the client's Sequence number + 1 which is **4126488337** |
| client -[ACK]-> server     | **Transmission Control Protocol, Src Port: 24491, Dst Port: 5000, Seq: 1, Ack: 1, Len: 0**<br/>    **Source Port: 24491**<br/>    Destination Port: 5000<br/>    [Stream index: 0]<br/>    [TCP Segment Len: 0]<br/>    **Sequence Number: 1    (relative sequence number)**<br/>    **Sequence Number (raw): 4126488337**<br/>    [Next Sequence Number: 1    (relative sequence number)]<br/>    **Acknowledgment Number: 1    (relative ack number)**<br/>    **Acknowledgment number (raw): 547479086**<br/>    0101 .... = Header Length: 20 bytes (5)<br/>    Flags: 0x010 (ACK)<br/>    Window: 10233<br/>    [Calculated window size: 2619648]<br/>    [Window size scaling factor: 256]<br/>    Checksum: 0xeace [unverified]<br/>    [Checksum Status: Unverified]<br/>    Urgent Pointer: 0<br/>    [SEQ/ACK analysis]<br/>    [Timestamps] | Client responses "I've received your number **xxxxxxx85**. And I add one to keep track, so now it is  **xxxxxxx86**. We are synced"<br />Client verifies receiving packet from the server by sending ACK (acknowledge) message.<br /> The ACK number is server's Squence number + 1, **547479086** |
| client -[PSH,ACK]-> server | **Transmission Control Protocol, Src Port: 24491, Dst Port: 5000, Seq: 1, Ack: 1, Len: 34**<br/>    Source Port: 24491<br/>    Destination Port: 5000<br/>    [Stream index: 0]<br/>    [TCP Segment Len: 34]<br/>    **Sequence Number: 1    (relative sequence number)**<br/>    **Sequence Number (raw): 4126488337**<br/>    **[Next Sequence Number: 35    (relative sequence number)]**<br/>    **Acknowledgment Number: 1    (relative ack number)**<br/>    **Acknowledgment number (raw): 547479086**<br/>    0101 .... = Header Length: 20 bytes (5)<br/>    Flags: 0x018 (PSH, ACK)<br/>    Window: 10233<br/>    [Calculated window size: 2619648]<br/>    [Window size scaling factor: 256]<br/>    Checksum: 0xd07d [unverified]<br/>    [Checksum Status: Unverified]<br/>    Urgent Pointer: 0<br/>    [SEQ/ACK analysis]<br/>    [Timestamps]<br/>    **TCP payload (34 bytes)**<br/>Data (34 bytes) | Now, client starts sending messages with flag **PSH** meaning "I have packed all the good stuffs, please send it imediately"<br /> Also, Next Sequence Number is expected to be 35 because it is sending out 34 bytes payload. ACK number is still **547479086** because it has not received anything from server |
| client <-[ACK]- server     | **Transmission Control Protocol, Src Port: 5000, Dst Port: 24491, Seq: 1, Ack: 35, Len: 0**<br/>    Source Port: 5000<br/>    Destination Port: 24491<br/>    [Stream index: 0]<br/>    [TCP Segment Len: 0]<br/>    Sequence Number: 1    (relative sequence number)<br/>    **Sequence Number (raw): 547479086**<br/>    [Next Sequence Number: 1    (relative sequence number)]<br/>    **Acknowledgment Number: 35    (relative ack number)**<br/>    **Acknowledgment number (raw): 4126488371**<br/>    0101 .... = Header Length: 20 bytes (5)<br/>    Flags: 0x010 (ACK)<br/>    Window: 10233<br/>    [Calculated window size: 2619648]<br/>    [Window size scaling factor: 256]<br/>    Checksum: 0xeaac [unverified]<br/>    [Checksum Status: Unverified]<br/>    Urgent Pointer: 0<br/>    [SEQ/ACK analysis]<br/>    [Timestamps] | After receiving the packet, server sends the ACK with previous ACK payload size (34). 4126488337 + 34 = **4126488371** |
| client -[FIN,ACK]-> server | **Transmission Control Protocol, Src Port: 24491, Dst Port: 5000, Seq: 35, Ack: 1, Len: 0**<br/>    Source Port: 24491<br/>    Destination Port: 5000<br/>    [Stream index: 0]<br/>    [TCP Segment Len: 0]<br/>    **Sequence Number: 35    (relative sequence number)**<br/>    **Sequence Number (raw): 4126488371**<br/>    [Next Sequence Number: 36    (relative sequence number)]<br/>    **Acknowledgment Number: 1    (relative ack number)**<br/>    **Acknowledgment number (raw): 547479086**<br/>    0101 .... = Header Length: 20 bytes (5)<br/>    Flags: 0x011 (FIN, ACK)<br/>    Window: 10233<br/>    [Calculated window size: 2619648]<br/>    [Window size scaling factor: 256]<br/>    Checksum: 0xeaab [unverified]<br/>    [Checksum Status: Unverified]<br/>    Urgent Pointer: 0<br/>    [Timestamps] | After sending a note, client terminal is close, so it sends FIN (finish?) and ACK to server. At this time, both Sequence number and ACK number are the same as the above because server did not send anything. |
| client <-[ACK]- server     | **Transmission Control Protocol, Src Port: 5000, Dst Port: 24491, Seq: 1, Ack: 36, Len: 0**<br/>    Source Port: 5000<br/>    Destination Port: 24491<br/>    [Stream index: 0]<br/>    [TCP Segment Len: 0]<br/>    Sequence Number: 1    (relative sequence number)<br/>    **Sequence Number (raw): 547479086**<br/>    [Next Sequence Number: 1    (relative sequence number)]<br/>    **Acknowledgment Number: 36    (relative ack number)**<br/>    **Acknowledgment number (raw): 4126488372**<br/>    0101 .... = Header Length: 20 bytes (5)<br/>    Flags: 0x010 (ACK)<br/>    Window: 10233<br/>    [Calculated window size: 2619648]<br/>    [Window size scaling factor: 256]<br/>    Checksum: 0xeaab [unverified]<br/>    [Checksum Status: Unverified]<br/>    Urgent Pointer: 0<br/>    [SEQ/ACK analysis]<br/>    [Timestamps] | After receiving the FIN flag, server response with an ACK message + 1. |
| client <-[FIN,ACK]- server | **Transmission Control Protocol, Src Port: 5000, Dst Port: 24491, Seq: 1, Ack: 36, Len: 0**<br/>    Source Port: 5000<br/>    Destination Port: 24491<br/>    [Stream index: 0]<br/>    [TCP Segment Len: 0]<br/>    Sequence Number: 1    (relative sequence number)<br/>    **Sequence Number (raw): 547479086**<br/>    [Next Sequence Number: 2    (relative sequence number)]<br/>    Acknowledgment Number: 36    (relative ack number)<br/>    **Acknowledgment number (raw): 4126488372**<br/>    0101 .... = Header Length: 20 bytes (5)<br/>    **Flags: 0x011 (FIN, ACK)**<br/>    Window: 10233<br/>    [Calculated window size: 2619648]<br/>    [Window size scaling factor: 256]<br/>    Checksum: 0xeaaa [unverified]<br/>    [Checksum Status: Unverified]<br/>    Urgent Pointer: 0<br/>    [Timestamps] | Now, server closes its portal "hey client, I'm done with you". Notice, Seq, and ACK are the same as above because server has not received anything from client.c |
| client -[ACK]- >server     | Transmission Control Protocol, Src Port: 24491, Dst Port: 5000, Seq: 36, Ack: 2, Len: 0<br/>    Source Port: 24491<br/>    Destination Port: 5000<br/>    [Stream index: 0]<br/>    [TCP Segment Len: 0]<br/>    Sequence Number: 36    (relative sequence number)<br/>    Sequence Number (raw): 4126488372<br/>    [Next Sequence Number: 36    (relative sequence number)]<br/>    Acknowledgment Number: 2    (relative ack number)<br/>    Acknowledgment number (raw): 547479087<br/>    0101 .... = Header Length: 20 bytes (5)<br/>    Flags: 0x010 (ACK)<br/>    Window: 10233<br/>    [Calculated window size: 2619648]<br/>    [Window size scaling factor: 256]<br/>    Checksum: 0xeaaa [unverified]<br/>    [Checksum Status: Unverified]<br/>    Urgent Pointer: 0<br/>    [SEQ/ACK analysis]<br/>    [Timestamps] | "Okay server, I have received your farewell letter so I will increase the ACK # to one ".<br /> Let reverse engineering, Client's seq:36, in which we know it has sent 1 byte for SYN, 1 byte for FIN, and the rest are the payload. Client's ack:2 shows us that it received 1 SYN and 1 FIN from server<br /> Also, Server's seq:1 means it has sent 1 byte for SYN, and probally closes. That is why we don't see the 2 seq. Server's ack:36 shows that clent sent 1 SYN, 1 FIN, and 34 bytes of payload.<br /> |
|                            |                                                              |                                                              |

