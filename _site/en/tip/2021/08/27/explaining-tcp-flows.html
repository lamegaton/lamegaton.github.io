<!DOCTYPE html>
<html class="no-js">
  <head>
	<meta charset="utf-8">
	<title>Explaining TCP flows | Son's NoteBook</title>
	<meta name="description"
		content="Couple days ago, I wrote a note showing how to set up a simple TCP client and server using netcat. Today, I have captured the packets from Wireshark and expl...">
	<meta property="og:site_name" content="lamegaton.github.io">
  
  <meta property="og:title" content="Explaining TCP flows">
  <meta property="og:type" content="article">
  <meta property="og:description" content="Couple days ago, I wrote a note showing how to set up a simple TCP client and server using netcat. Today, I have captured the packets from Wireshark and explained them step by step so everyone can have a general idea on how TCP flow works. Let’s look at the table below.

"/>
  
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- CSS -->
	<link rel="stylesheet" href="/assets/css/main.css">

	<!--Favicon-->
	<link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

	<!-- Canonical -->
	<link rel="canonical" href="/en/tip/2021/08/27/explaining-tcp-flows.html">

	<!-- RSS -->
	<link rel="alternate" type="application/atom+xml" title="Son's NoteBook"
		href="/feed.xml" />

	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
		integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">

	<!-- Google Fonts -->
	
	<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic" rel="stylesheet"
		type="text/css">
	

	<!-- KaTeX -->
	
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">

	<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
	
	<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>
	

	<!-- Google Analytics -->
	
</head>
  <body>
    <header class="site-header">
	<div class="branding">
		
		<a href="/">
			<img class="avatar" src="/assets/img/avatar.png" alt=""/>
		</a>
		
		<h1 class="site-title">
			<a href="/">Son's NoteBook</a>
		</h1>
	</div>
	<nav class="site-nav">
		<ul>
			
			
			
			
			
			<li>
				<a class="page-link" href="/about/">
					About
				</a>
			</li>
			
			
			
			<li>
				<a class="page-link" href="/categories/">
					Categories
				</a>
			</li>
			
			
			
			
			
			
			
			
			
			<li>
				<a class="page-link" href="/tools/">
					Get Youtube Transcript
				</a>
			</li>
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			<!-- Social icons from Font Awesome, if enabled  -->
			


<li>
	<a href="mailto:sonpham995@gmail.com" title="Email">
		<i class="fas fa-fw fa-envelope"></i>
	</a>
</li>













<li>
	<a href="https://github.com/lamegaton/" title="Follow on GitHub">
		<i class="fab fa-fw fa-github"></i>
	</a>
</li>







<li>
	<a href="https://www.linkedin.com/in/sphamee/" title="Follow on LinkedIn">
		<i class="fab fa-fw fa-linkedin"></i>
	</a>
</li>

























            <!-- Search bar -->
            
            <li>
            <form action="/search.html" method="get">
                <input type="text" id="search-box" name="query" placeholder="Search" class="">
                <button type="submit" class="">
                    <i class="fa fa-fw fa-search"></i>
                </button>
            </form>
            </li>
            
		</ul>
	</nav>

</header>

    <div class="content">
      <article class="feature-image">
  <header style="background-image: url('/assets/img/wireshark.png')">
    <h1 class="title">Explaining TCP flows</h1>
    
    <p class="meta">
      August 27, 2021
       - Son Pham
    </p>
  </header>
  <section class="post-content"><p>Couple days ago, I wrote a note showing how to set up a simple TCP client and server using netcat. Today, I have captured the packets from Wireshark and explained them step by step so everyone can have a general idea on how TCP flow works. Let’s look at the table below.</p>

<table>
  <thead>
    <tr>
      <th>Flow</th>
      <th>Packet captured from Wireshark</th>
      <th>Explaination</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>client -[SYN]-&gt; server</td>
      <td><strong>Transmission Control Protocol, Src Port: 24491, Dst Port: 5000, Seq: 0, Len: 0</strong><br />    <strong>Source Port: 24491</strong><br />    Destination Port: 5000<br />    [Stream index: 0]<br />    [TCP Segment Len: 0]<br />    <strong>Sequence Number: 0</strong>    (relative sequence number)<br />    <strong>Sequence Number (raw): 4126488336</strong><br />    [Next Sequence Number: 1    (relative sequence number)]<br />    <strong>Acknowledgment Number: 0</strong><br />    <strong>Acknowledgment number (raw): 0</strong><br />    1000 …. = Header Length: 32 bytes (8)<br />    <strong>Flags: 0x002 (SYN)</strong><br />    <strong>Window: 65535</strong><br />    [Calculated window size: 65535]<br />    Checksum: 0xd6b0 [unverified]<br />    [Checksum Status: Unverified]<br />    Urgent Pointer: 0<br /></td>
      <td>First, client says “hi there, I’d like to connect, here is my number <strong>xxxxxxx36</strong> “<br /><br />When client send a SYN packet to server. Wireshark will show you the relative sequence, or ACK number which is 0. But actually, it is a random number .<br /><br /></td>
    </tr>
    <tr>
      <td>client &lt;-[SYN,ACK]- server</td>
      <td><strong>Transmission Control Protocol, Src Port: 5000, Dst Port: 24491, Seq: 0, Ack: 1, Len: 0</strong><br />    <strong>Source Port: 5000</strong><br />    Destination Port: 24491<br />    [Stream index: 0]<br />    [TCP Segment Len: 0]<br />    <strong>Sequence Number: 0</strong>    (relative sequence number)<br />    <strong>Sequence Number (raw): 547479085</strong><br />    [Next Sequence Number: 1    (relative sequence number)]<br />    <strong>Acknowledgment Number: 1</strong>    (relative ack number)<br />    <strong>Acknowledgment number (raw): 4126488337</strong><br />    1000 …. = Header Length: 32 bytes (8)<br />    <strong>Flags: 0x012 (SYN, ACK)</strong><br />    <strong>Window: 65535</strong><br />    [Calculated window size: 65535]<br />    Checksum: 0xd7d0 [unverified]<br />    [Checksum Status: Unverified]<br />    Urgent Pointer: 0<br />    Options: (12 bytes), Maximum segment size, No-Operation (NOP), Window scale, No-Operation (NOP), No-Operation (NOP), SACK permitted<br />    [SEQ/ACK analysis]<br />    [Timestamps]</td>
      <td>Server responses “oh sure, I’ve received your number <strong>xxxxxxx36</strong>. And I add one to keep track, so now it is  <strong>xxxxxxx37</strong>. Please take my number <strong>xxxxxxx85</strong> “<br />After received the packet from client, server will send its own Sequence number <strong>547479085</strong> and Ackowledgement number.<br />The Acknowledge number is the client’s Sequence number + 1 which is <strong>4126488337</strong></td>
    </tr>
    <tr>
      <td>client -[ACK]-&gt; server</td>
      <td><strong>Transmission Control Protocol, Src Port: 24491, Dst Port: 5000, Seq: 1, Ack: 1, Len: 0</strong><br />    <strong>Source Port: 24491</strong><br />    Destination Port: 5000<br />    [Stream index: 0]<br />    [TCP Segment Len: 0]<br />    <strong>Sequence Number: 1    (relative sequence number)</strong><br />    <strong>Sequence Number (raw): 4126488337</strong><br />    [Next Sequence Number: 1    (relative sequence number)]<br />    <strong>Acknowledgment Number: 1    (relative ack number)</strong><br />    <strong>Acknowledgment number (raw): 547479086</strong><br />    0101 …. = Header Length: 20 bytes (5)<br />    Flags: 0x010 (ACK)<br />    Window: 10233<br />    [Calculated window size: 2619648]<br />    [Window size scaling factor: 256]<br />    Checksum: 0xeace [unverified]<br />    [Checksum Status: Unverified]<br />    Urgent Pointer: 0<br />    [SEQ/ACK analysis]<br />    [Timestamps]</td>
      <td>Client responses “I’ve received your number <strong>xxxxxxx85</strong>. And I add one to keep track, so now it is  <strong>xxxxxxx86</strong>. We are synced”<br />Client verifies receiving packet from the server by sending ACK (acknowledge) message.<br /> The ACK number is server’s Squence number + 1, <strong>547479086</strong></td>
    </tr>
    <tr>
      <td>client -[PSH,ACK]-&gt; server</td>
      <td><strong>Transmission Control Protocol, Src Port: 24491, Dst Port: 5000, Seq: 1, Ack: 1, Len: 34</strong><br />    Source Port: 24491<br />    Destination Port: 5000<br />    [Stream index: 0]<br />    [TCP Segment Len: 34]<br />    <strong>Sequence Number: 1    (relative sequence number)</strong><br />    <strong>Sequence Number (raw): 4126488337</strong><br />    <strong>[Next Sequence Number: 35    (relative sequence number)]</strong><br />    <strong>Acknowledgment Number: 1    (relative ack number)</strong><br />    <strong>Acknowledgment number (raw): 547479086</strong><br />    0101 …. = Header Length: 20 bytes (5)<br />    Flags: 0x018 (PSH, ACK)<br />    Window: 10233<br />    [Calculated window size: 2619648]<br />    [Window size scaling factor: 256]<br />    Checksum: 0xd07d [unverified]<br />    [Checksum Status: Unverified]<br />    Urgent Pointer: 0<br />    [SEQ/ACK analysis]<br />    [Timestamps]<br />    <strong>TCP payload (34 bytes)</strong><br />Data (34 bytes)</td>
      <td>Now, client starts sending messages with flag <strong>PSH</strong> meaning “I have packed all the good stuffs, please send it imediately”<br /> Also, Next Sequence Number is expected to be 35 because it is sending out 34 bytes payload. ACK number is still <strong>547479086</strong> because it has not received anything from server</td>
    </tr>
    <tr>
      <td>client &lt;-[ACK]- server</td>
      <td><strong>Transmission Control Protocol, Src Port: 5000, Dst Port: 24491, Seq: 1, Ack: 35, Len: 0</strong><br />    Source Port: 5000<br />    Destination Port: 24491<br />    [Stream index: 0]<br />    [TCP Segment Len: 0]<br />    Sequence Number: 1    (relative sequence number)<br />    <strong>Sequence Number (raw): 547479086</strong><br />    [Next Sequence Number: 1    (relative sequence number)]<br />    <strong>Acknowledgment Number: 35    (relative ack number)</strong><br />    <strong>Acknowledgment number (raw): 4126488371</strong><br />    0101 …. = Header Length: 20 bytes (5)<br />    Flags: 0x010 (ACK)<br />    Window: 10233<br />    [Calculated window size: 2619648]<br />    [Window size scaling factor: 256]<br />    Checksum: 0xeaac [unverified]<br />    [Checksum Status: Unverified]<br />    Urgent Pointer: 0<br />    [SEQ/ACK analysis]<br />    [Timestamps]</td>
      <td>After receiving the packet, server sends the ACK with previous ACK payload size (34). 4126488337 + 34 = <strong>4126488371</strong></td>
    </tr>
    <tr>
      <td>client -[FIN,ACK]-&gt; server</td>
      <td><strong>Transmission Control Protocol, Src Port: 24491, Dst Port: 5000, Seq: 35, Ack: 1, Len: 0</strong><br />    Source Port: 24491<br />    Destination Port: 5000<br />    [Stream index: 0]<br />    [TCP Segment Len: 0]<br />    <strong>Sequence Number: 35    (relative sequence number)</strong><br />    <strong>Sequence Number (raw): 4126488371</strong><br />    [Next Sequence Number: 36    (relative sequence number)]<br />    <strong>Acknowledgment Number: 1    (relative ack number)</strong><br />    <strong>Acknowledgment number (raw): 547479086</strong><br />    0101 …. = Header Length: 20 bytes (5)<br />    Flags: 0x011 (FIN, ACK)<br />    Window: 10233<br />    [Calculated window size: 2619648]<br />    [Window size scaling factor: 256]<br />    Checksum: 0xeaab [unverified]<br />    [Checksum Status: Unverified]<br />    Urgent Pointer: 0<br />    [Timestamps]</td>
      <td>After sending a note, client terminal is close, so it sends FIN (finish?) and ACK to server. At this time, both Sequence number and ACK number are the same as the above because server did not send anything.</td>
    </tr>
    <tr>
      <td>client &lt;-[ACK]- server</td>
      <td><strong>Transmission Control Protocol, Src Port: 5000, Dst Port: 24491, Seq: 1, Ack: 36, Len: 0</strong><br />    Source Port: 5000<br />    Destination Port: 24491<br />    [Stream index: 0]<br />    [TCP Segment Len: 0]<br />    Sequence Number: 1    (relative sequence number)<br />    <strong>Sequence Number (raw): 547479086</strong><br />    [Next Sequence Number: 1    (relative sequence number)]<br />    <strong>Acknowledgment Number: 36    (relative ack number)</strong><br />    <strong>Acknowledgment number (raw): 4126488372</strong><br />    0101 …. = Header Length: 20 bytes (5)<br />    Flags: 0x010 (ACK)<br />    Window: 10233<br />    [Calculated window size: 2619648]<br />    [Window size scaling factor: 256]<br />    Checksum: 0xeaab [unverified]<br />    [Checksum Status: Unverified]<br />    Urgent Pointer: 0<br />    [SEQ/ACK analysis]<br />    [Timestamps]</td>
      <td>After receiving the FIN flag, server response with an ACK message + 1.</td>
    </tr>
    <tr>
      <td>client &lt;-[FIN,ACK]- server</td>
      <td><strong>Transmission Control Protocol, Src Port: 5000, Dst Port: 24491, Seq: 1, Ack: 36, Len: 0</strong><br />    Source Port: 5000<br />    Destination Port: 24491<br />    [Stream index: 0]<br />    [TCP Segment Len: 0]<br />    Sequence Number: 1    (relative sequence number)<br />    <strong>Sequence Number (raw): 547479086</strong><br />    [Next Sequence Number: 2    (relative sequence number)]<br />    Acknowledgment Number: 36    (relative ack number)<br />    <strong>Acknowledgment number (raw): 4126488372</strong><br />    0101 …. = Header Length: 20 bytes (5)<br />    <strong>Flags: 0x011 (FIN, ACK)</strong><br />    Window: 10233<br />    [Calculated window size: 2619648]<br />    [Window size scaling factor: 256]<br />    Checksum: 0xeaaa [unverified]<br />    [Checksum Status: Unverified]<br />    Urgent Pointer: 0<br />    [Timestamps]</td>
      <td>Now, server closes its portal “hey client, I’m done with you”. Notice, Seq, and ACK are the same as above because server has not received anything from client.c</td>
    </tr>
    <tr>
      <td>client -[ACK]- &gt;server</td>
      <td>Transmission Control Protocol, Src Port: 24491, Dst Port: 5000, Seq: 36, Ack: 2, Len: 0<br />    Source Port: 24491<br />    Destination Port: 5000<br />    [Stream index: 0]<br />    [TCP Segment Len: 0]<br />    Sequence Number: 36    (relative sequence number)<br />    Sequence Number (raw): 4126488372<br />    [Next Sequence Number: 36    (relative sequence number)]<br />    Acknowledgment Number: 2    (relative ack number)<br />    Acknowledgment number (raw): 547479087<br />    0101 …. = Header Length: 20 bytes (5)<br />    Flags: 0x010 (ACK)<br />    Window: 10233<br />    [Calculated window size: 2619648]<br />    [Window size scaling factor: 256]<br />    Checksum: 0xeaaa [unverified]<br />    [Checksum Status: Unverified]<br />    Urgent Pointer: 0<br />    [SEQ/ACK analysis]<br />    [Timestamps]</td>
      <td>“Okay server, I have received your farewell letter so I will increase the ACK # to one “.<br /> Let reverse engineering, Client’s seq:36, in which we know it has sent 1 byte for SYN, 1 byte for FIN, and the rest are the payload. Client’s ack:2 shows us that it received 1 SYN and 1 FIN from server<br /> Also, Server’s seq:1 means it has sent 1 byte for SYN, and probally closes. That is why we don’t see the 2 seq. Server’s ack:36 shows that clent sent 1 SYN, 1 FIN, and 34 bytes of payload.<br /></td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
  </tbody>
</table>

</section>
  

</article>

<!-- Disqus -->

<div class="comments">
  <div id="disqus_thread"></div>
<script type="text/javascript">
	var disqus_shortname = 'lamegaton';
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view comments.</noscript>

</div>


<!-- Post navigation -->


    </div>
    
<script src="/assets/js/katex_init.js"></script>



<footer class="site-footer">
	<p class="text">Powered by <a href="https://jekyllrb.com/">Jekyll</a> with <a href="https://github.com/rohanchandra/type-theme">Type Theme</a> by Son Pham
</p>
</footer>


  </body>
</html>
